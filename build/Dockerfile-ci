FROM node:12-alpine AS BUILD_IMAGE
# cloudbuild use /workspace as default folder
# https://cloud.google.com/cloud-build/docs/build-config#dir
WORKDIR /workspace
RUN apk update && apk add --no-cache \
 openssh-client git \
 build-base \    
   autoconf \
    automake \
    bash \
    g++ \
    libc6-compat \
    libjpeg-turbo-dev \
    libpng-dev \
    make \
    nasm \
    xdg-utils \
    ca-certificates \
    libpng-dev freetype-dev libjpeg-turbo-dev \
    libtool

COPY package*.json ./

# Install package for the root project, then go to hkclient-ts package, install its package
RUN ADBLOCK=true npm ci 
#&& cd ./node_modules/hkclient-ts && ADBLOCK=true npm i && npm run build && rm -rf /workspace/*

CMD [ "sleep", "infinity" ]
